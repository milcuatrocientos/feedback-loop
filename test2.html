<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta charset="utf-8">
    <title>light pattern</title>
    <script type="text/javascript" src="jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="raphael-min.js"></script>
    <script type="text/javascript" src="utils.js"></script>
    <script>
      /* TODO
        -boton start/stop
        -ajuste frecuencia, duracion, radio
        -controles para ajuste dinamico
      */
      window.onload = function() {
        var canvasWidth = 800, canvasHeight = 500;
        var cfg = {
          maxDistance: Math.min(canvasWidth, canvasHeight) / 5,
          maxRadius:   Math.min(canvasWidth, canvasHeight) / 10,
          interval: 0.1, duration: 0.5
        };

        var paper = Raphael('canvas-container', canvasWidth, canvasHeight);
        var mousePos = new Coord(canvasWidth/2, canvasHeight/2);

        var $canvas = $(paper.canvas);
        $canvas.css('border', '1px solid black');
        $canvas.mousemove(function(e) {
          mousePos.x = e.offsetX;
          mousePos.y = e.offsetY;
        });

        var animate = function() {
          var radius = Math.random() * cfg.maxRadius;
          var color = Raphael.rgb(Math.random()*255, Math.random()*255, Math.random()*255);
          var centerOffset = new Polar(
            Math.random() * cfg.maxDistance,
            Math.random() * 2*Math.PI
          ).to_coord();

          var circle = paper.circle(centerOffset.x + mousePos.x, centerOffset.y + mousePos.y, radius)
                            .attr({stroke: color, fill: color});

          circle.animate({opacity: 0}, 1000*cfg.duration, 'linear', function() { circle.remove(); });

          window.setTimeout(animate, 1000*cfg.interval);
        };
        animate();
      };
    </script>
  </head>
  <body>
    <div id="canvas-container" style="text-align: center;" />
  </body>
</html>
